---
title: "Exercicio 5"
author: "Pedro Buril"
output: github_document
---

# Exercício 5

## Markdown

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Carregue o banco de dados `world` que está no pacote `poliscidata`.

```{r}
library(poliscidata)
library(tidyverse)

banco <- world

```

### Existem diversas medidas de democracia para os países: `dem_score14`, `democ11`, `fhrate04_rev`, `fhrate08_rev`, `polity`. Descreva-as graficamente e diga quais são as diferenças entre tais medidas.

```{r}

  banco_selecionado <- banco %>%
  transmute(dem_score14, democ11, fhrate04_rev, fhrate08_rev, polity) 
 
 glimpse(banco_selecionado)
 
 ggplot(banco_selecionado, aes(dem_score14)) +
geom_histogram(aes(y=..density..),
               binwidth=1) + 
   geom_density() + 
   geom_vline(aes(xintercept = mean(dem_score14, na.rm = T)))

ggplot(banco, aes(democ11)) +
  geom_bar(na.rm = T) 

ggplot(banco, aes(fhrate04_rev)) +
  geom_histogram(aes(y=..density..),
                 binwidth=1) +
  geom_density() + 
  geom_vline(aes(xintercept = mean(fhrate04_rev, na.rm = T)))

ggplot(banco, aes(x = "", y = fhrate08_rev)) +
  geom_violin(draw_quantiles = c(0.25, 0.5, 0.75))

ggplot(banco, aes(polity)) +
  geom_histogram(binwidth = 1)

## Todas essas variáveis medem os diferentes graus de democracia. Dentre essas variáveis, os valores podem assumir valores negativos (polity, por exemplo), positivos ou decimais (dem_score14, fhrate04_rev). Há variáveis que são discretas e contínuas. Na prática, isso representaria um país mais ou menos democrático. Para as variáveis que assumem valores negativos (polity), um valor negativo seria um país não-democrático. 
## Uma coisa que me chamou a atenção é a semelhança em como os dados estão distribuídos nessas variáveis. Percebemos que muitos casos dessas variáveis se concentram no extremo positivo para a democracia (democ11, fhrate04_rev, fhrate08_rev, polity, por exemplo) 

``` 
  
### Avalie a relação entre todas as medidas de democracia e desigualdade, utilizando a variável `gini08`. Descreva graficamente esta variável, a relação entre as duas variáveis, meça a correlação entre elas e faça regressões lineares (interpretando em profundidade os resultados dos coeficientes e medidas de desempenho dos modelos). Enfatize as semelhanças e diferenças entre os resultados. Quais são suas conclusões?

```{r, echo = FALSE}
glimpse(banco)

banco2 <- banco %>%
filter(!is.na(dem_score14), 
!is.na(democ11), 
!is.na(fhrate04_rev), 
!is.na(fhrate08_rev), 
!is.na(polity),
!is.na(gini08))

####################################################################################################################

ggplot(banco2, aes(gini08)) +
  geom_histogram(aes(y=..density..),
                 binwidth = 5) +
  geom_density(adjust = 0.8) +
  geom_vline(aes(xintercept = mean(gini08, na.rm = T)))

#########################################################################################################

cor.test(banco2$gini08, banco2$dem_score14)

modelo <- lm(data = banco2, formula = gini08 ~ dem_score14)
modelo$coefficients
summary(modelo)

#temos a equação da reta ajustada 7.3 + -0.03 * gini
## O valor do R² ajustado está bem baixo. Isso singnifica que há uma grande parte do modelo que não está sendo explicado. Quanto mais asteriscos presentes ao lado do efeito estimado, maior o nível de confiança com que podemos afirmar que o efeito não é nulo. No caso presente, encontramos *** no intercept, mas nenhum para o gini08, isso também afirma que há uma explicação limitada no modelo. 

cor.test(banco2$gini08, banco2$democ11)
modelo2 <- lm(data = banco2, formula = gini08 ~ democ11)
modelo2$coefficients

summary(modelo2)
##O intervalo de confiança detém do valor 0, que mostra que não há significância estatística. A equação da reta ajustada 7.6 + -0.02 * gini. O r² ajustado é muito pequeno (pode ser causado por apenas 1 variável inserida no modelo) e muitos astericos presentes no intercept, mas poucos presentes na variável independente (quanto mais astériscos, maior o nível de confiança que podemos afirmar que o efeito não é nulo) que mostram que há uma explicação limitada no modelo

cor.test(banco2$gini08, banco2$fhrate04_rev)
modelo3 <- lm(data = banco2, formula = gini08 ~ fhrate04_rev)
modelo3$coefficients
summary(modelo3)

cor.test(banco2$gini08, banco2$fhrate08_rev)
modelo4 <- lm(data = banco2, formula = gini08 ~ fhrate08_rev)
modelo4$coefficients
summary(modelo4)

cor.test(banco2$gini08, banco2$polity)
modelo5 <- lm(data = banco2, formula = gini08 ~ polity)
modelo5$coefficients
summary(modelo5)

## O intervalo de confiança contém o valor 0 em seu intervalo, isso significa que não há significância estatística. 
## Todas as variáveis de democracia quando testadas com o coeficiente de gini, mostram que não há relação estatística. Acredito que essa unanimidade de não correlação pode dar alguma robustez ao estudo da não correlação entre essas duas variáveis. Já que essas variáveis medem a mesma coisa (grau de Democracia e desigualdade social), seria estranho que algum dessess testes dessem significância estátistica, isso poderia ser uma falha de mensuração ou de operacionalização da variável Democracia. Vale destacar que os países se concentram na faixa de 30-40 gini. Como gini mede desigualdade, e quanto maior o coeficiente, maior a desigualdade, casos com gini 50 já são casos com uma desigualdade muito alta. Se fizessemos um gráfico relacionando os países com o gini encontraríamos o Brasil e poucos outros mais a cima do valor 50. 

## Dentre todos os testes, a semelhança são o R² ajustado muito baixo (o que mostra a falta de explicação do modelo), mas algo que é normal tendo em vista que nesse modelo utilizamos apenas 1 variável. A quantidade de astericos presentes ao lado do efeito estimado (3 astericos em todos os modelos), o que dá um maior nível de confiança de que o efeito não é nulo. 

## O residual standard error (ou RMSE) indica o erro médio, ou seja, a distância média entre os valores observados e os valores estimados. No nossos casos, ele está bem alto.

####################################################################################################################

ggplot(banco2, aes(gini08, dem_score14)) +
geom_jitter() +
  geom_smooth(method = lm, se = FALSE) +
theme_classic()

ggplot(banco2, aes(gini08, democ11)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_minimal()

ggplot(banco2, aes(gini08, fhrate04_rev)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_classic()

ggplot(banco2, aes(gini08, fhrate08_rev)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_classic()

ggplot(banco2, aes(gini08, polity)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
theme_minimal()
```

### Avalie a relação entre todas as medidas de democracia e crescimento econômico, utilizando a variável `gdppcap08`. Descreva graficamente esta variável, a relação entre as duas variáveis, meça a correlação entre elas e faça regressões lineares (interpretando em profundidade os resultados dos coeficientes e medidas de desempenho dos modelos). Enfatize as semelhanças e diferenças entre os resultados. Quais são suas conclusões?

```{r, echo = FALSE}


banco3 <- banco %>%
filter(!is.na(dem_score14), 
!is.na(democ11), 
!is.na(fhrate04_rev), 
!is.na(fhrate08_rev), 
!is.na(polity),
!is.na(gdppcap08))

####################################################################################################################

ggplot(banco3, aes(x = "", y = gdppcap08)) +
 geom_violin(draw_quantiles = c(0.25, 0.5, 0.75))

##################################################################################################################
cor.test(banco3$gdppcap08, banco3$dem_score14)

## Como entre o intervalo de confiança não inclui o 0, o resultado pode ter significância estátistica, como pode se verificar pelo valor do p-valor. 

modelo <- lm(data = banco3, formula = gdppcap08 ~ dem_score14)
modelo$coefficients
summary(modelo)

#O R² ajustado, que indica o quanto da variação presente nos dados está sendo explicada pela covariável, está bem baixo, entretanto, isso pode ser justificado pelo modelo só incluir 1 variável independente. Os asteriscos mostram o nível de confiança com que podemos afirmar que o efeito não é nulo. Pro caso da variável dem_score14, é uma boa mostra de que há algum tipo de influência. O residual standard error (ou RMSE) indica o erro médio, ou seja, a distância média entre os valores observados e os valores estimados. No nosso caso, ele está bem alto.

cor.test(banco3$gdppcap08, banco3$democ11)

## Como entre o intervalo de confiança não inclui o 0, o resultado pode ter significância estátistica, como pode se verificar pelo valor do p-valor.

modelo2 <- lm(data = banco3, formula = gdppcap08 ~ democ11)
modelo2$coefficients
summary(modelo2)

#O R² ajustado, que indica o quanto da variação presente nos dados está sendo explicada pela covariável, está bem baixo, entretanto, isso pode ser justificado pelo modelo só incluir 1 variável independente. Os asteriscos mostram o nível de confiança com que podemos afirmar que o efeito não é nulo. Pro caso da variável democ11, comparado com a dem_score14, tem mais asteriscos, logo é uma boa mostra de que há algum tipo de influência. O residual standard error (ou RMSE) indica o erro médio, ou seja, a distância média entre os valores observados e os valores estimados. No nosso caso, ele está bem alto.

cor.test(banco3$gdppcap08, banco3$fhrate04_rev)

modelo3 <- lm(data = banco3, formula = gdppcap08 ~ fhrate04_rev)
modelo3$coefficients
summary(modelo3)

cor.test(banco3$gdppcap08, banco3$fhrate08_rev)

modelo4 <- lm(data = banco3, formula = gdppcap08 ~ fhrate08_rev)
modelo4$coefficients
summary(modelo4)

cor.test(banco3$gdppcap08, banco3$polity)

modelo5 <- lm(data = banco3, formula = gdppcap08 ~ polity)
modelo5$coefficients
summary(modelo5)

## Em comum para as variáveis de democracia encontramos um alto RSE, um R² ajustado muito baixo, alguns asteriscos no intercept e na variável, que podem justificar algum tipo de explicação do modelo. Um p-valor baixo, que também pode ser um bom sinal da explicação do modelo. Quando menor que 0.05 podemos rejeitar a hipótese de homogeneidade de variâncias ao nível de 95% de confiança.

#####################################################################################################################

ggplot(banco3, aes(gdppcap08, dem_score14)) +
geom_jitter() +
  geom_smooth(method = lm, se = FALSE) +
theme_classic()

ggplot(banco3, aes(gdppcap08, democ11)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_minimal()

ggplot(banco3, aes(gdppcap08, fhrate04_rev)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_classic()

ggplot(banco3, aes(gdppcap08, fhrate08_rev)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_classic()

ggplot(banco3, aes(gdppcap08, polity)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
theme_minimal()
```

### Avalie a relação entre todas as medidas de democracia e produção de petróleo, utilizando a variável `oil`. Descreva graficamente esta variável, a relação entre as duas variáveis, meça a correlação entre elas e faça regressões lineares (interpretando em profundidade os resultados dos coeficientes e medidas de desempenho dos modelos). Enfatize as semelhanças e diferenças entre os resultados. Quais são suas conclusões?

```{r, echo = FALSE}


banco4 <- banco %>%
filter(!is.na(dem_score14), 
!is.na(democ11), 
!is.na(fhrate04_rev), 
!is.na(fhrate08_rev), 
!is.na(polity),
!is.na(oil))

####################################################################################################################

ggplot(banco4, aes(oil))+
  geom_histogram(bins = 15)

##################################################################################################################
cor.test(banco4$oil, banco4$dem_score14)

## O valor 0 está no intervalo de confiança, o resultado não possui significância estatística, como pode ser verificado pelo valor do p-valor. 

modelo <- lm(data = banco4, formula = oil ~ dem_score14)
modelo$coefficients
summary(modelo)

## O r² ajustado está muito pequeno, o p-valor não está em um intervalo de confiança aceitável, tem poucos asteriscos (apenas 2), o RSE está bastante alto. Esse não seria um bom modelo.

cor.test(banco4$oil, banco4$democ11)

modelo2 <- lm(data = banco4, formula = oil ~ democ11)
modelo2$coefficients
summary(modelo2)

## Este modelo se parece bastante com o modelo anterior. O p-valor não está no intervalo estátistico (< 0.05), RSE muito alto, o R² muito baixo e poucos astericos que possam dar validade a explicação do modelo. 

cor.test(banco4$oil, banco4$fhrate04_rev)

modelo3 <- lm(data = banco4, formula = oil ~ fhrate04_rev)
modelo3$coefficients
summary(modelo3)

cor.test(banco4$oil, banco4$fhrate08_rev)

modelo4 <- lm(data = banco3, formula = gdppcap08 ~ fhrate08_rev)
modelo4$coefficients
summary(modelo4)

cor.test(banco4$oil, banco4$polity)
modelo5 <- lm(data = banco4, formula = gdppcap08 ~ polity)
modelo5$coefficients
summary(modelo5)

## Neste último caso encontramos um comportamento diferente, encontramos muitos astericos, um p-valor aceitável estatisticamente, um intervalo de confiança negativo (que não inclui o 0), um R² ajustado bastante baixo também. Para a variável Polity, houve uma melhor correlação. A equação da reta ajustada é: E(Y) = 11416 + 406*polity

#####################################################################################################################

ggplot(banco4, aes(oil, dem_score14)) +
geom_jitter() +
  geom_smooth(method = lm, se = FALSE) +
theme_classic()

ggplot(banco4, aes(oil, democ11)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_minimal()

ggplot(banco4, aes(oil, fhrate04_rev)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_classic()

ggplot(banco4, aes(oil, fhrate08_rev)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
  theme_classic()

ggplot(banco4, aes(oil, polity)) +
  geom_jitter() +
    geom_smooth(method = lm, se = FALSE) +
theme_minimal()
```

### Avalie a relação entre crescimento econômico e produção de petróleo. Descreva a relação entre as duas variáveis, meça a correlação entre elas e faça regressões lineares (interpretando em profundidade os resultados dos coeficientes e medidas de desempenho dos modelos). Enfatize as semelhanças e diferenças entre os resultados. Quais são suas conclusões?
```{r, echo = FALSE}


banco5 <- banco %>%
filter(!is.na(gdppcap08), 
!is.na(oil))

####################################################################################################################

cor.test(banco4$gdppcap08, banco4$oil)

## O intervalo de confiança não detém o valor 0, que pode ter significância estátistica. O p-valor está aceitável estátisticamente

modelo <- lm(data = banco5, formula = gdppcap08 ~ oil)
modelo$coefficients
summary(modelo)

# O r² ajustado está mt baixo, o p-valor está aceitável estatisticamente (< 0.5), há bastante asteriscos no modelo, aumentando o nível de confiança. 

#####################################################################################################################

ggplot(banco4, aes(gdppcap08, oil)) +
geom_jitter() +
  geom_smooth(method = lm, se = FALSE) +
theme_classic()

```

### A partir das suas conclusões sobre a relação entre democracia, economia e produção de petróleo, quais considerações são possíveis fazer sobre a relação CAUSAL entre estas variáveis? Lembre dos 4 "hurdles" do livro *Fundamentals of Political Science Research*

* Is there a credible causal mechanism that connects X to Y?
* Can we rule out the possibility that Y could cause X?
* Is there covariation between X and Y?
* Have we controlled for all confounding variables Z that might make the association between X and Y spurious?
  
* É plausível que variáveis econômicas expliquem desempenho democrático. Entretanto, não me parece crível que a * * * variável produção de óleo consiga explicar desempenho democrático. Apesar de em nossos modelos só inserirmos uma variável independente e isso por si só já afetar bastante a capacidade explicativa do mesmo, não temos nenhum modelo que mostre resultados amplamente confiáveis ou robustos. Há um amplo arcabouço teórico que fornece um amplo mecanismo causal de que desempenho econômico afeta a saúde das instituições democráticas, entretanto, como nosso modelo pretende explicar fenômenos sociais complexos, é necessário modelos mais completos. Entrentanto, no caso do modelo que utiliza as variáveis "oil" and "gdppcap08", ele nos fornece resultados relativamente aceitáveis. O que pode nos sugerir que há uma relação entre produção de petróleo e desempenho econômico, mas não que há uma significância estatística entre "oil" e desempenho democrático (talvez seja o caso de analisar a geopolítica dos países que são grandes produtores de petróleo e que podem não estar sendo analisados corretamente em nosso modelo). Não parece plausível que podemos afirmar que Y não causa X. É necessário analisar a literatura e resultados de modelos mais robustos para afirmarmos que economia causa democracia e não o contrário. Sendo assim, pode haver convariação entre X e Y. Por fim, não controlamos todas as variáveis que podem estar associadas com X e Y. Esse é um modelo teste que ainda carece de mais variáveis explicativas.  
  

